<!DOCTYPE html>
<html>

<head>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        html {
            padding: 0px;
            margin: 0px;
            background-color: rgb(235, 232, 226);
            font-family: monospace;
            text-align: center;
        }

        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }

        .tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 5px 10px;
            border-radius: 3px;
            pointer-events: none;
            opacity: 0;
        }

        .text-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: left;
        }
    </style>
</head>

<body>
    <div class="text-container">
        <h1>Pride and Prejudice: Character Emotions</h1>
        <p>
            We have created a bubble chart to illustrate the emotions of the main characters over time, with the main
            events on the x-axis and the intensity of their emotions on the y-axis. The size of the bubbles represents
            the intensity of the characters' emotions.
        </p>
    </div>

    <script>
        const margin = { top: 20, right: 20, bottom: 100, left: 50 },
            width = 800 - margin.left - margin.right,
            height = 500 - margin.top - margin.bottom;

        const x = d3.scalePoint().range([0, width]).padding(0.5);
        const y = d3.scaleLinear().range([height, 0]);

        const xAxis = d3.axisBottom(x);
        const yAxis = d3.axisLeft(y);
        

        const emotions = ["pride", "prejudice", "humility", "tolerance"];
        const emotionColors = ["#FFD700", "#FF4500", "#32CD32", "#1E90FF"];

        const svg = d3
            .select("body")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        const tooltip = d3
            .select("body")
            .append("div")
            .attr("class", "tooltip");

        d3.csv("character_score.csv").then((data) => {
            const events = Array.from(new Set(data.map(d => d.main_event)));
            x.domain(events);
            y.domain([0, 10]);

            svg
                .append("g")
                .attr("class", "x axis")
                .attr("transform", `translate(0,${height})`)
                .call(xAxis)
                .selectAll("text")
                .attr("y", function (d, i) {
                    return i % 2 === 0 ? 10 : -40;
                })
                .attr("x", 0)
                .attr("dy", ".35em")
                .attr("transform", "rotate(0)")
                .style("text-anchor", "middle");
                

            svg.append("g").attr("class", "y axis").call(yAxis);
                    svg.selectAll(".circle")
                .data(data)
                .enter()
                .append("circle")
                .attr("class", "circle")
                .attr("cx", (d) => x(d.main_event))
                .attr("cy", (d) => y(+d.intensity_score))
                .attr("r", (d) => Math.sqrt(d.intensity_score) * 6)
                .attr("fill", (d) => emotionColors[emotions.indexOf(d.emotion)])
                .on("mouseover", function (event, d) {
                    tooltip
                        .style("opacity", 1)
                        .html(
                            `Character: ${d.character}<br>Event: ${d.main_event}<br>Emotion: ${d.emotion}<br>Intensity Score: ${d.intensity_score}`
                        )
                        .style("left", `${event.pageX + 10}px`)
                        .style("top", `${event.pageY + 10}px`);
                })
                .on("mouseout", function () {
                    tooltip.style("opacity", 0);
                });
            // Right y-axis
            const yAxisRight = d3.axisRight(y);
             const characterImages = {
                "Elizabeth": "images/lizzie.png",
                "Darcy": "path_to_darcy_image",
                "Jane": "path_to_jane_image",
                "Bingley": "path_to_bingley_image"
            };

            const characterColors = {
                "Elizabeth": "#FF6961",
                "Darcy": "#77DD77",
                "Jane": "#FFB447",
                "Bingley": "#779ECB"
            };

            const characters = ["Elizabeth", "Darcy", "Jane", "Bingley"];

            // ...

            // Add character images with circles of different colors at the corners
            characters.forEach((character, i) => {
                svg.append("circle")
                    .attr("cx", i % 2 === 0 ? width - 25 : 25)
                    .attr("cy", i < 2 ? 25 : height - 25)
                    .attr("r", 25)
                    .attr("fill", characterColors[character]);

                svg.append("svg:image")
                    .attr("xlink:href", characterImages[character])
                    .attr("x", i % 2 === 0 ? width - 50 : 0)
                    .attr("y", i < 2 ? 0 : height - 50)
                    .attr("width", 50)
                    .attr("height", 50);
            });

                
            svg.append("g")
                .attr("class", "y axis")
                .attr("transform", `translate(${width}, 0)`)
                .call(yAxisRight);


            // Add emotion labels at the corners
            svg.append("text")
                .attr("x", 0)
                .attr("y", 0)
                .attr("dy", "-1em")
                .style("text-anchor", "start")
                .style("fill", emotionColors[0])
                .text(emotions[0]);

            svg.append("text")
                .attr("x", width)
                .attr("y", 0)
                .attr("dy", "-1em")
                .style("text-anchor", "end")
                .style("fill", emotionColors[1])
                .text(emotions[1]);

            svg.append("text")
                .attr("x", 0)
                .attr("y", height)
                .attr("dy", "1.5em")
                .style("text-anchor", "start")
                .style("fill", emotionColors[2])
                .text(emotions[2]);

            svg.append("text")
                .attr("x", width)
                .attr("y", height)
                .attr("dy", "1.5em")
                .style("text-anchor", "end")
                .style("fill", emotionColors[3])
                .text(emotions[3]);
        });

                    </script>
                    </body>
                    
                    </html>